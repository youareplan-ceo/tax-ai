<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <title>YouaPlan EasyTax v8 - AI 세무 코파일럿</title>
    
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/npm/suit-font@1.0.0/variable.css" rel="stylesheet">
    <link rel="preload" as="image" href="/app/assets/logo.webp" imagesrcset="/app/assets/logo.png">
    
    <style>
        :root{--bg:#f7f8fa;--card:#fff;--ink:#0b1023;--ink-2:#5f6a82;--brand:#0066ff;--danger:#ff3b30;--success:#12c29c;--radius:14px;--radius-lg:18px;--shadow:0 6px 24px rgba(17,27,56,.06);--gap-2:10px;--gap-3:14px;--gap-4:18px;--gap-5:24px}
        html,body{margin:0;font-family:"SUIT Variable",system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Pretendard,sans-serif;background:var(--bg);color:var(--ink)}
        img{max-width:100%;height:auto} *{box-sizing:border-box}
        header.appbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;gap:var(--gap-3);padding:18px 20px;background:#fff;box-shadow:var(--shadow)}
        .logo-img{height:88px;max-height:18vh} @media(max-width:768px){.logo-img{height:72px}}
        .summary-wrap{display:grid;gap:12px;margin:14px 2px}
        .summary-card{background:#fff;border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:16px 18px}
        .summary-value{font-size:28px;font-weight:800}
        .tabbar{position:fixed;left:0;right:0;bottom:0;height:64px;background:#fff;display:flex;justify-content:space-around;align-items:center;box-shadow:0 -8px 24px rgba(17,27,56,.08);border-top:1px solid #eef1f5}
        .tabbar a{color:var(--ink-2);font-weight:600;text-decoration:none;transition:transform .12s ease}
        .tabbar a:active{transform:scale(.98)} .tabbar a.active{color:var(--brand)}
        .fab{position:fixed;right:18px;bottom:86px;width:56px;height:56px;border-radius:50%;background:var(--brand);color:#fff;border:0;box-shadow:var(--shadow);font-size:28px;line-height:56px}
    </style>
    
    <link rel="stylesheet" href="/app/styles.min.css?v=3" onerror="this.href='/app/styles.css?v=3';">
    <link rel="manifest" href="/app/manifest.json">
</head>
<body>
    <header class="appbar">
        <a class="brand" href="/app/">
            <img class="logo-img" src="/app/assets/logo.png" alt="YouaPlan EasyTax">
        </a>
    </header>
    
    <!-- 서브탭 내비게이션 - 월/카테고리/현금흐름 -->
    <nav class="subtabs" role="navigation" aria-label="서브 내비게이션">
        <button data-v="month" class="active" aria-pressed="true">월</button>
        <button data-v="category" aria-pressed="false">카테고리</button>
        <button data-v="cash" aria-pressed="false">현금흐름</button>
    </nav>
    
    <main>
        <section class="summary-wrap">
            <div class="summary-card">
                <div>이번 달 합계</div>
                <div class="summary-value" id="sum-month">₩0</div>
            </div>
            <div class="summary-card">
                <div>카테고리 상위</div>
                <div id="top-cats">—</div>
            </div>
        </section>
        
        <section id="ledger">
            <!-- 스켈레톤 UI - 로딩 중 표시 -->
            <div class="ledger-skeleton"></div>
            <div class="ledger-skeleton"></div>
            <div class="ledger-skeleton"></div>
            <div class="ledger-skeleton"></div>
            <div class="ledger-skeleton"></div>
            <div class="ledger-skeleton"></div>
            
            <!-- 실제 데이터 카드들 -->
            <div class="ledger-card">
                <div>
                    <div class="ledger-merchant">카페 스타벅스</div>
                    <div class="ledger-date">2024-09-11</div>
                </div>
                <div class="ledger-amount neg">-₩5,500</div>
            </div>
            <div class="ledger-card">
                <div>
                    <div class="ledger-merchant">월급 입금</div>
                    <div class="ledger-date">2024-09-01</div>
                </div>
                <div class="ledger-amount pos">+₩3,200,000</div>
            </div>
        </section>
    </main>
    
    <nav class="tabbar" role="tablist" aria-label="메인 내비게이션">
        <a data-tab="ledger" class="active" role="tab" aria-selected="true" aria-label="가계부 탭">가계부</a>
        <a data-tab="upload" role="tab" aria-selected="false" aria-label="업로드 탭">업로드</a>
        <a data-tab="ai" role="tab" aria-selected="false" aria-label="자동분류 탭">자동분류</a>
        <a data-tab="report" role="tab" aria-selected="false" aria-label="리포트 탭">리포트</a>
        <a data-tab="easy" role="tab" aria-selected="false" aria-label="간편신고 탭">간편신고</a>
    </nav>
    
    <button class="fab" aria-label="새 가계부 입력 추가" role="button">＋</button>

    <script defer>
        // 서비스워커 등록
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/app/sw.js');
        }
        
        // 스켈레톤 UI 숨김 및 IntersectionObserver로 지연 렌더링
        document.addEventListener('DOMContentLoaded', function() {
            // 2초 후 스켈레톤 숨김 (실제로는 API 로드 완료 후)
            setTimeout(function() {
                const skeletons = document.querySelectorAll('.ledger-skeleton');
                skeletons.forEach(skeleton => {
                    skeleton.style.display = 'none';
                });
            }, 2000);
            
            // IntersectionObserver로 카드 지연 로딩 시뮬레이션
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            // 가계부 카드들에 대해 관찰자 설정
            const cards = document.querySelectorAll('.ledger-card');
            cards.forEach(card => observer.observe(card));
            
            // 서브탭/하단탭 클릭 이벤트 보장
            document.querySelectorAll('.subtabs button, .tabbar button').forEach(btn => {
                btn.type = 'button';
                btn.addEventListener('click', e => {
                    const g = e.currentTarget.dataset.v || e.currentTarget.name || e.currentTarget.dataset.tab;
                    document.querySelectorAll('.subtabs button, .tabbar button').forEach(b => b.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    // 필요한 경우 화면 전환 핸들러 호출
                    if (window.onTabChange) window.onTabChange(g);
                }, {passive: true});
            });
        });
    </script>
</body>
</html>
